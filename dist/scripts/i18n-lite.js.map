{"version":3,"file":"i18n-lite.js","sources":["CatLab/i18n-lite/Translate.js","i18n-lite.js"],"names":["define","jquery","sprintf","Cookies","args","i","tmp","Translate","this","defaultLanguage","language","translations","cookie","p","prototype","initialize","options","tracker","getLanguage","deferred","Deferred","$","getJSON","tryLoadTranslations","substr","bind","get","navigator","locales","locale","shift","json","setTranslation","fail","length","noTranslation","bundle","resolve","translate","string","arguments","push","getArgumentNumericValue","track","getTranslation","vsprintf","isPluralizable","img","Image","src","encodeURIComponent","getPluralized","amount","plural","single","key","value","resources","changeLanguage","set","expires","argument","isNumeric","parseFloat"],"mappings":"AAAAA,OACA,8BACA,SACA,UACA,aAEA,SACAC,EACAC,EACAC,GAEA,GAWAC,GACAC,EACAC,EAbAC,EAAA,WAEAC,KAAAC,gBAAA,KACAD,KAAAE,SAAA,KACAF,KAAAG,gBACAH,KAAAI,OAAA,YAIAC,EAAAN,EAAAO,SA2LA,OArLAD,GAAAE,WAAA,SAAAC,GAEA,mBAAA,KACAA,MAGAR,KAAAC,gBAAAO,EAAAP,iBAAA,KACAD,KAAAS,QAAAD,EAAAC,SAAA,KACAT,KAAAI,OAAAI,EAAAJ,QAAA,WAEAJ,KAAAE,SAAAF,KAAAU,aAEA,IAAAC,GAAAlB,EAAAmB,UAUA,OATAZ,MAAAW,SAAAA,EAEAE,EAAAC,QAAA,yBAAA,WAEAd,KAAAG,gBACAH,KAAAe,qBAAAf,KAAAE,SAAAF,KAAAE,SAAAc,OAAA,EAAA,MAEAC,KAAAjB,OAEAW,GAQAN,EAAAK,YAAA,WAEA,GAAAR,EAWA,OARAA,GADAF,KAAAI,QAAAT,EAAAuB,IAAAlB,KAAAI,QACAT,EAAAuB,IAAAlB,KAAAI,QAEA,mBAAAe,WAAA,SACAA,UAAAjB,SAGAF,KAAAC,iBAUAI,EAAAU,oBAAA,SAAAK,GAEA,GAAAC,GAAAD,EAAAE,OAEAT,GAAAC,QAAA,WAAAO,EAAA,QAAA,SAAAE,GAEAvB,KAAAwB,eAAAD,IAEAN,KAAAjB,OAAAyB,KAAA,WAEAL,EAAAM,OAAA,EACA1B,KAAAe,oBAAAK,GAGApB,KAAA2B,iBAGAV,KAAAjB,QAIAK,EAAAmB,eAAA,SAAAI,GAEA5B,KAAAG,aAAAyB,EACA5B,KAAAW,SAAAkB,WAGAxB,EAAAsB,cAAA,WAEA3B,KAAAW,SAAAkB,WAGAxB,EAAAyB,UAAA,SAAAC,GAEA,GAAA,KAAAA,EACA,MAAAA,EAGA,KADAnC,KACAC,EAAA,EAAAA,EAAAmC,UAAAN,OAAA7B,IACAD,EAAAqC,KAAAD,UAAAnC,GAqBA,OAlBAkC,GAAAnC,EAAA0B,QAGAxB,EAAA,KAEAF,EAAA8B,OAAA,IACA5B,EAAAE,KAAAkC,wBAAAtC,EAAA,KAGA,OAAAE,GACAE,KAAAmC,MAAAJ,GAAA,GACAA,EAAA/B,KAAAoC,eAAAL,EAAAjC,KAGAE,KAAAmC,MAAAJ,GAAA,GACAA,EAAA/B,KAAAoC,eAAAL,IAGArC,EAAA2C,SAAAN,EAAAnC,IAGAS,EAAA8B,MAAA,SAAAJ,EAAAO,GAEA,GAAAC,GAAA,GAAAC,MACAD,GAAAE,IAAA/C,EAAA2C,SACArC,KAAAS,SAEAiC,mBAAAX,GACAO,EAAA,EAAA,KAKAjC,EAAAsC,cAAA,SAAAnC,EAAAoC,GAEA,GAAA,IAAAA,GAAAA,EAAA,GACA,GAAA,mBAAApC,GAAA,OACA,MAAAA,GAAAqC,WAKA,IAAA,mBAAArC,GAAA,OACA,MAAAA,GAAAsC,MAMA,KAAA,GAAAC,KAAAvC,GACA,MAAAA,GAAAuC,IAIA1C,EAAA+B,eAAA,SAAAL,EAAAa,GAEA,GAAA,mBAAA5C,MAAAG,aAAA,UACA,MAAA4B,EAGA,IAAAiB,GAAAhD,KAAAG,aAAA8C,UAAAlB,EAEA,OAAA,mBAAA,GACAA,EAGA,gBAAA,GACA/B,KAAA2C,cAAAK,EAAAJ,GAIAI,GAIA3C,EAAA6C,eAAA,SAAAhD,GAEAP,EAAAwD,IAAAnD,KAAAI,OAAAF,GAAAkD,QAAA,OAGA/C,EAAA6B,wBAAA,SAAAmB,GAEA,MAAAxC,GAAAyC,UAAAD,GACAE,WAAAF,GAEA,MAGAtD,IAGAP,OCjNA,aAEA,8BAEA,SAAAO,GACA,MAAA,IAAAA","sourcesContent":["define (\n\t'CatLab/i18n-lite/Translate',[\n\t\t'jquery',\n\t\t'sprintf',\n\t\t'js-cookie'\n\t],\n\tfunction (\n\t\tjquery,\n\t\tsprintf,\n\t\tCookies\n\t) {\n\t\tvar Translate = function (options) {\n\n\t\t\tthis.defaultLanguage = 'en';\n\t\t\tthis.language = 'en';\n\t\t\tthis.translations = {};\n\t\t\tthis.cookie = 'language';\n\n\t\t};\n\n\t\tvar p = Translate.prototype;\n\n\t\tvar args;\n\t\tvar i;\n\t\tvar tmp;\n\n\t\tp.initialize = function (options)\n\t\t{\n\t\t\tif (typeof (options) === 'undefined') {\n\t\t\t\toptions = {};\n\t\t\t}\n\n\t\t\tthis.defaultLanguage = options.defaultLanguage || 'en';\n\t\t\tthis.tracker = options.tracker || null;\n\t\t\tthis.cookie = options.cookie || 'language';\n\n\t\t\tthis.language = this.getLanguage ();\n\n\t\t\tvar deferred = jquery.Deferred();\n\t\t\tthis.deferred = deferred;\n\n\t\t\t$.getJSON ('locales/languages.json', function (data) {\n\n\t\t\t\tthis.translations = [];\n\t\t\t\tthis.tryLoadTranslations ([ this.language, this.language.substr (0, 2) ]);\n\n\t\t\t}.bind (this));\n\n\t\t\treturn deferred;\n\n\t\t};\n\n\t\t/**\n\t\t * Get current language\n\t\t * @returns string\n\t\t */\n\t\tp.getLanguage = function ()\n\t\t{\n\t\t\tvar language;\n\n\t\t\tif (this.cookie && Cookies.get (this.cookie)) {\n\t\t\t\tlanguage = Cookies.get(this.cookie);\n\t\t\t}\n\t\t\telse if (typeof (navigator.language) !== 'undefined') {\n\t\t\t\tlanguage = navigator.language;\n\t\t\t}\n\t\t\telse\n\t\t\t\tlanguage = this.defaultLanguage;\n\n\t\t\treturn language;\n\t\t};\n\n\t\t/**\n\t\t * Go trough all provided translations and stop as soon\n\t\t * as we have succesfully loaded one.\n\t\t * @param locales\n\t\t */\n\t\tp.tryLoadTranslations = function (locales) {\n\n\t\t\tvar locale = locales.shift ();\n\n\t\t\t$.getJSON(\"locales/\"+ locale +\".json\", function(json) {\n\n\t\t\t\tthis.setTranslation (json);\n\n\t\t\t}.bind(this)).fail (function () {\n\n\t\t\t\tif (locales.length > 0) {\n\t\t\t\t\tthis.tryLoadTranslations (locales);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.noTranslation ();\n\t\t\t\t}\n\n\t\t\t}.bind (this));\n\n\t\t};\n\n\t\tp.setTranslation = function (bundle)\n\t\t{\n\t\t\tthis.translations = bundle;\n\t\t\tthis.deferred.resolve ();\n\t\t};\n\n\t\tp.noTranslation = function()\n\t\t{\n\t\t\tthis.deferred.resolve ();\n\t\t};\n\n\t\tp.translate = function (string)\n\t\t{\n\t\t\tif(string === \"\")\n\t\t\t\treturn string;\n\n\t\t\targs = [];\n\t\t\tfor (i = 0; i < arguments.length; i ++) {\n\t\t\t\targs.push (arguments[i]);\n\t\t\t}\n\n\t\t\tstring = args.shift ();\n\n\t\t\t// Also check first variable\n\t\t\ttmp = null;\n\n\t\t\tif (args.length > 0) {\n\t\t\t\ttmp = this.getArgumentNumericValue(args[0]);\n\t\t\t}\n\n\t\t\tif (tmp !== null) {\n\t\t\t\tthis.track (string, true);\n\t\t\t\tstring = this.getTranslation (string, tmp);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.track (string, false);\n\t\t\t\tstring = this.getTranslation (string);\n\t\t\t}\n\n\t\t\treturn sprintf.vsprintf (string, args);\n\t\t};\n\n\t\tp.track = function (string, isPluralizable)\n\t\t{\n\t\t\tvar img = new Image();\n\t\t\timg.src = sprintf.vsprintf (\n\t\t\t\tthis.tracker,\n\t\t\t\t[\n\t\t\t\t\tencodeURIComponent(string),\n\t\t\t\t\tisPluralizable ? 1 : 0\n\t\t\t\t]\n\t\t\t);\n\t\t};\n\n\t\tp.getPluralized = function (options, amount)\n\t\t{\n\t\t\tif (amount === 0 || amount > 1) {\n\t\t\t\tif (typeof (options.plural) !== 'undefined') {\n\t\t\t\t\treturn options.plural;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\tif (typeof (options.single) !== 'undefined') {\n\t\t\t\t\treturn options.single;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Not found? Return first value.\n\t\t\t//noinspection LoopStatementThatDoesntLoopJS\n\t\t\tfor (var key in options) {\n\t\t\t\treturn options[key];\n\t\t\t}\n\t\t};\n\n\t\tp.getTranslation = function (string, amount)\n\t\t{\n\t\t\tif (typeof (this.translations.resources) === 'undefined') {\n\t\t\t\treturn string;\n\t\t\t}\n\n\t\t\tvar value = this.translations.resources[string];\n\n\t\t\tif (typeof (value) === 'undefined') {\n\t\t\t\treturn string;\n\t\t\t}\n\n\t\t\telse if (typeof (value) === 'object') {\n\t\t\t\treturn this.getPluralized (value, amount);\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\n\t\tp.changeLanguage = function (language)\n\t\t{\n\t\t\tCookies.set (this.cookie, language, { expires: 365 });\n\t\t};\n\n\t\tp.getArgumentNumericValue = function (argument)\n\t\t{\n\t\t\tif ($.isNumeric (argument)) {\n\t\t\t\treturn parseFloat (argument);\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\n\t\treturn Translate;\n\t}\n);\n","define (\n\t'i18n-lite',\n\t[\n\t\t'CatLab/i18n-lite/Translate'\n\t],\n\tfunction (Translate) {\n\t\treturn new Translate ();\n\t}\n);\n"]}